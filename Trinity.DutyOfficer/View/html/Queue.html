<div class="table-wrapper formWrapper">
    <div class="tab-header">
        <span class="formHeader"><b>Queue</b></span>
    </div>
    <div class="tab-content">
        <div class="form-inline float-left">
            <div class="currentDate" current-date></div>
        </div>
        <div class="form-inline formEntries float-right">
            <div class="entries">Display </div>
            <select class="form-control" id="pageSize">
                <option>10</option>
                <option>25</option>
                <option>50</option>
                <option>100</option>
            </select>
            <div class="entries"> entries per page</div>
        </div>
        <table id="table-queue"></table>
    </div>
</div>
<script type="text/javascript">
    
    $('#menu').show();
    activemenu('Queue');
    $("#menu .menu-item").removeClass("active");
    $("#menu [item-menu].active").parent().addClass("active");
    var today = new Date();
    var dd = today.getDate();
    var monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
    var mm = monthNames[today.getMonth()];
    var yyyy = today.getFullYear();
    if (dd < 10) {
        dd = '0' + dd;
    }
    var today = dd + ' ' + mm + ' ' + yyyy;
    $('[current-date]').text(today);
    api.server.getDataQueue(function (data) {
        $('#table-queue').bootstrapTable({
            search: true,
            pagination: true,
            pageSize:10,
            pageList: [10, 25, 50, 100],
            onClickCell: function (field, value, row, $element) {
                if (field == "HSA" && $.trim(value).length > 0 && row.Queue_ID != null) {                    
                    api.server.LoadPopupSeal(row.Date, row.UserId, row.Queue_ID, value, function () {
                        $('#idQueueSeal').modal();
                    });
                }
            },
            onDblClickCell: function (field, value, row, $element) {
                if (field == 'Message' && $.trim(value.content).length > 0 && row.Queue_ID != null) {
                    api.server.LoadPopupQueue(row.Queue_ID, function () {
                        $('#idQueue').modal();
                    });
                }
            },
            columns: [
                {
                    field: 'SN',
                    title: 'S/N',
                    align: 'center',
                    formatter: function (value, row, index) {
                        return index + 1;
                    }
                },
                {
                    field: 'NRIC',
                    title: 'NRIC',
                    align: 'center',
                    sortable: true
                },
                {
                    field: 'Name',
                    title: 'Name',
                    align: 'center',
                    sortable: true
                },
                {
                    field: 'APS',
                    title: 'APS',
                    align: 'center',
                    formatter: function (value, row, index, field) {
                        return '<span colorState="' + value.toLowerCase()+'" style="background-color:' + value + ';"></span>';
                    }
                },
                {
                    field: 'SSK',
                    title: 'SSK',
                    align: 'center',
                    formatter: function (value, row, index, field) {
                        return '<span colorState style="background-color:' + value + ';"></span>';
                    }
                },
                {
                    field: 'SSA',
                    title: 'SSA',
                    align: 'center',
                    formatter: function (value, row, index, field) {
                        return '<span colorState style="background-color:' + value + ';"></span>';
                    }
                },
                {
                    field: 'UHP',
                    title: 'UHP',
                    align: 'center',
                    formatter: function (value, row, index, field) {
                        return '<span colorState style="background-color:' + value + ';"></span>';
                    }
                },
                {
                    field: 'HSA',
                    title: 'UT',
                    align: 'center',
                    formatter: function (value, row, index, field) {
                        if (value == 'NEG') {
                            return '<span style="color:green;display:inline-block;padding:2px 5px;border:1px solid #CCC;">' + value + '</span>';
                        }
                        else if (value == 'POS') {
                            return '<span style="color:red;display:inline-block;padding:2px 5px;border:1px solid #CCC;">' + value + '</span>';
                        }
                        else {
                            return '';
                        }
                    }
                },
                {
                    field: 'ESP',
                    title: 'ESP',
                    align: 'center',
                    formatter: function (value, row, index, field) {
                        return '<span colorState="' + value + '" style="background-color:' + value + ';"></span>';
                    }
                },
                {
                    field: 'Outcome',
                    title: 'Outcome',
                    align: 'center'
                },
                {
                    field: 'Message',
                    title: 'Message',
                    align: 'center',
                    formatter: function (value, row, index, field) {
                        return '<span>' + value.content + '</span>';
                    }
                }
            ],
            data: data
        });
    });

    api.server.startInstanceSmartcard();

    function reloadDataQueues() {
        api.server.getDataQueue(function (data) {
            $('#table-queue').bootstrapTable('load', data);
            $('#table-queue').bootstrapTable('refreshOptions', {
                pagination: true,
                data: data
            });
        });
    };

    function openPopupOutcome(queueId) {
        api.server.LoadPopupOutcome(queueId, function () {
            $('#idQueueOutcome').modal();
        });
    };

    $('#pageSize').change(function () {
        pageSize = $("#pageSize option:selected").text();
        $('#table-queue').bootstrapTable('refreshOptions', {
            pagination: true,
            //search: true,
            pageSize: pageSize
        });
    });
</script>
<style>
    span[colorState] {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        display: inline-block;
        border: 1px solid #333;
        box-sizing: border-box;
    }

    span[colorState="notrequired"] {
        background-color: white;
    }

        span[colorState="notrequired"]::after {
            content: "X";
            line-height: 0px;
            text-align: center;
            font-size: 20px;
            font-weight: normal;
        }
</style>
